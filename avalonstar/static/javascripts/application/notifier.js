// Generated by CoffeeScript 1.7.1
(function() {
  var channel, delay, poolDonating, poolHosting, poolSubscribing, pusher, running, subscribed;

  delay = 5;

  running = false;

  poolDonating = 0;

  poolHosting = 0;

  poolSubscribing = 0;

  subscribed = function(data, added) {
    if (!running) {
      console.log("" + data.username + " has subscribed!");
      running = true;
      if (poolSubscribing >= 1) {
        ($('.js-type')).text('Subscription Streak');
      } else {
        ($('.js-type')).text('Subscription');
      }
      ($('.js-username')).text(data.username);
      ($('.js-subscribed')).addClass('visible');
      return setTimeout((function() {
        ($('.js-subscribed')).removeClass('visible');
        running = false;
        if (poolSubscribing >= 1) {
          poolSubscribing--;
          return console.log("There are " + poolSubscribing + " subs left in the pool.");
        }
      }), 6000);
    } else {
      if (!added) {
        poolSubscribing++;
        console.log("There are " + poolSubscribing + " subs left in the pool.");
      }
      return setTimeout((function() {
        console.log("Running the pool subscription for, " + data.username + ".");
        return subscribed(data, true);
      }), delay * 1000);
    }
  };

  Pusher.log = function(message) {
    if (window.console && window.console.log) {
      window.console.log(message);
    }
  };

  pusher = new Pusher('207f2c96da3bdb9301f8');

  channel = pusher.subscribe('live');

  channel.bind('subscribed', function(data) {
    return subscribed(data, false);
  });

}).call(this);
